{% extends 'base.html' %}
{% block title %}Panel Administrador{% endblock %}
{% block nav %}
<a href="/" class="text-white text-decoration-underline">Salir</a>
{% endblock %}
{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!--Carga de archivos -->
<div class="bg-white p-5 rounded shadow mb-4">
  <h2 class="h4 mb-4">Actualizar Base de Datos desde Excel</h2>
  <form method="post" action="{{ url_for('upload_excel') }}" enctype="multipart/form-data" class="row g-3 align-items-center">
    <div class="col-auto">
      <input type="file" name="file" class="form-control" required>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-success">Actualizar</button>
    </div>
  </form>
  <div class="form-text mt-2">
    Sube <b>vehiculos.xlsx</b> para actualizar la tabla vehiculos o <b>servicios.xlsx</b> para la tabla servicios.
  </div>
</div>

<!-- Informacion de la unidad -->
<div class="bg-white p-5 rounded shadow">
  <h2 class="h4 mb-4">Estado de Revisión</h2>
  <div style="max-height: 500px; overflow-y: auto;">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>ID Vehículo</th>
          <th>Cliente</th>
          <th>Aire</th>
          <th>Jala</th>
          <th>Mochila</th>
          <th>Conv/Reparación</th>
          <th>Reinsidente</th>
          <th>Revisado</th>
        </tr>
      </thead>
      <tbody>
        {% for v in vehiculos %}
        <tr {% if v.revisado %}class="table-success"{% endif %}>
          <td>{{ v.idvehiculo or ' ' }}</td>
          <td>{{ v.descripcion or ' ' }}</td>
          <td>{{ v.aire or ' ' }}</td>
          <td>{{ v.jala or ' ' }}</td>
          <td>{{ v.mochila or ' ' }}</td>
          <td>{{ v.conversion_reparacion or ' ' }}</td>
          <td>{{ v.reinsidente or ' ' }}</td>
          <td>{{ 'Sí' if v.revisado else 'No' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <a href="{{ url_for('export') }}" class="btn btn-primary mt-3">Exportar Consolidado</a>
</div>
{% endblock %}
